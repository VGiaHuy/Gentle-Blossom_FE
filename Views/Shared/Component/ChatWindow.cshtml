@model Gentle_Blossom_FE.Data.DTOs.UserDTOs.ChatViewModel

<div class="chat-window">
    <div class="p-3 border-bottom d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center">
            <div>
                <h5 class="mb-0 fw-bold text-primary">@Model.SelectedRoom.ChatRoomName</h5>
            </div>
        </div>
        <div>
            <button class="btn btn-outline-primary btn-sm me-2" title="Gọi video"><i class="bi bi-camera-video-fill"></i></button>
            <button class="btn btn-outline-primary btn-sm me-2" title="Gọi thoại"><i class="bi bi-telephone-fill"></i></button>
            <button class="btn btn-outline-primary btn-sm" title="Chi tiết"><i class="bi bi-info-circle"></i></button>
        </div>
    </div>
    <div class="chat-messages" id="chatMessages">
        @foreach (var message in Model.Messages)
        {
            <div class="message @(message.IsOutgoing ? "outgoing ms-auto" : "incoming") p-2 mb-3">
                <p class="mb-1">@message.Content</p>
                @if (!string.IsNullOrEmpty(message.AttachmentUrl))
                {
                    if (message.AttachmentType.StartsWith("image"))
                    {
                        <img src="@message.AttachmentUrl" alt="Attachment" class="message-attachment">
                    }
                    else if (message.AttachmentType.StartsWith("video"))
                    {
                        <video src="@message.AttachmentUrl" controls class="message-attachment"></video>
                    }
                    else
                    {
                        <a href="@message.AttachmentUrl" class="text-decoration-none">Tải file</a>
                    }
                }
                <small class="d-block text-muted @(message.IsOutgoing ? "text-end" : "")">@message.SentAt.ToString("HH:mm")</small>
                @if (message.IsOutgoing)
                {
                    <button class="btn btn-sm btn-danger delete-message" data-message-id="@message.MessageId">Xóa</button>
                }
            </div>
        }
    </div>
    <div class="chat-input">
        <form id="sendMessageForm" enctype="multipart/form-data">
            <input type="hidden" name="chatRoomId" value="@Model.SelectedRoom.ChatRoomId" />
            <input type="hidden" name="senderId" value="@Model.CurrentUserId" />
            <div class="input-group">
                <input type="text" class="form-control rounded-start-3" placeholder="Nhập tin nhắn..." name="content" id="messageInput">
                <input type="file" class="d-none" id="attachmentInput" name="attachment">
                <label for="attachmentInput" class="btn btn-outline-primary"><i class="bi bi-paperclip"></i></label>
                <button type="submit" class="btn btn-primary rounded-end-3"><i class="bi bi-send-fill"></i></button>
            </div>
        </form>
    </div>
</div>